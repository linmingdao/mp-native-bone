<import src="../../components/wxParse/wxParse.wxml" />
<view class="container">
  <view class="title">{{title}}</view>
  <view class="time">
    <view>{{date}}</view>
    <!-- 文章日期 -->
    <view>来源: {{source}}</view>
    <!-- 文章来源 -->
  </view>
  <!-- 文章内容 -->
  <view class="article">
    <template is="wxParse" data="{{wxParseData:detailsContent.nodes}}" />
  </view>
  <!-- 九宫格 -->
  <view class="sudoku">
    <view class="sudoku_item" wx:for="{{photo}}" wx:key="{{index}}" wx:for-item="pSrc">
      <image bindtap="previewImage" data-src="{{pSrc}}" data-list="{{photo}}" src="{{pSrc}}" />
    </view>
  </view>
  <!-- 文章操作按钮区域 -->
  <view class="footer">
    <view wx:if="{{type === 'event' && status === 1 && role === 'admin'}}" class="opt_item img-icon icon-forward--gray_at" bindtap="forward"></view>
    <text class="comment-btn" bindtap="showCommentsDialog">留 言</text>
  </view>
  <view class="comment-box">
    <view class="comment-item" wx:key="{{item._id}}" wx:for-item="item" wx:for="{{commentsList}}">
      <view class="avatar-area">
        <image src="{{item.mid.avatar_url}}" />
      </view>
      <view class="content-area">
        <view class="nickname-area">
          <text class="name">{{item.mid.name || item.mid.nickname}}</text>
          <view wx:if="{{role === 'admin'}}" class="delete-comment-btn" data-id="{{item._id}}" bind:tap="deleteComment">
            x
          </view>
        </view>
        <view class="date">{{item.date}}</view>
        <view class="content-text">{{item.content}}</view>
      </view>
    </view>
  </view>
</view>
<!-- 留言弹窗 -->
<view wx:if="{{isShowCommentsDialog}}">
  <view class="mask_layer"></view>
  <view class="modal_box">
    <view class="title">留言内容</view>
    <view class="content">
      <textarea fixed="{{true}}" maxlength="{{-1}}" class="comment-input" bindinput='handleInputComments' value="{{currentComments}}" placeholder="请输入" auto-focus="{{true}}" adjust-position="{{true}}"></textarea>
    </view>
    <view class="btn-area">
      <view class="cancel-btn" bindtap="hideCommentsDialog">取消</view>
      <view class="sure-btn" bindtap="doComment">确定</view>
    </view>
  </view>
</view>